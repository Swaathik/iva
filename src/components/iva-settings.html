<link rel="import" href="../jso-styles.html">

<dom-module id="iva-settings">
    <template>
        <style is="custom-style" include="jso-styles"></style>

        <div>
            <h4>CellBase</h4>
            <hr>
            <div class="form-group row">
                <label for="cellbaseHost" class="col-sm-2 col-form-label">Host URL</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="cellbaseHost" value="http://bioinfo.hpc.cam.ac.uk/cellbase">
                </div>
            </div>
            <div class="form-group row">
                <label for="cellbaseVersion" class="col-sm-2 col-form-label">Version</label>
                <div class="col-sm-2">
                    <select name="version" class="form-control" id="cellbaseVersion">
                        <option>v3</option>
                        <option selected>v4</option>
                    </select>
                </div>
            </div>

            <h4>Visual Settings</h4>
            <hr>

            <!--TODO Replace with dom-repeat-->

            <div class="col-sm-3">
                <label>Consequence Type</label>
            </div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">High</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component" id="consequenceTypeHigh">
                        <input type="text" value="#ff0000" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Moderate</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ffa500" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Low</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#0000ff" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Modifier</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#00ff00" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>
            <hr>

            <div class="col-sm-3"><label>Sift</label></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Deleterious</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ff0000" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Tolerated</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#00ff00" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>
            <hr>

            <div class="col-sm-3">
                <label>Polyphen</label>
            </div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Probably Damaging</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ff0000" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Possibly Damaging</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ffa500" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Benign</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#00ff00" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Unknown</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#000000" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>
            <hr>

            <div class="col-sm-3">
                <label>Population Frequencies</label>
            </div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Very Rare</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ff0000" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Rare</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ffff00" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Average</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#ffa500" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>

            <div class="col-sm-3"></div>
            <div class="form-group row">
                <label class="col-sm-2" style="font-weight: normal">Common</label>
                <div class="col-sm-3">
                    <div class="input-group colorpicker-component">
                        <input type="text" value="#0000ff" class="form-control" />
                        <span class="input-group-addon"><i></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group row" style="float: right;">
                    <button type="button" class="btn btn-primary" on-click="buildConfig">OK</button>
            </div>
        </div>

    </template>
    <script>
        Polymer({
            is: 'iva-settings',
            properties: {
                opencgaClient: {
                    type: Object,
                    observer: 'checkUserConfig'
                },
                config: {
                    type: Object,
                    value: {}
                }
            },
            attached: function () {
                let _this = this;
                $('.colorpicker-component').colorpicker();
                
                $('.colorpicker-component').on('changeColor', function (e) {
                    _this.config[e.target.id] = $("#" + e.target.id + "> input").val();
                });

            },
            checkUserConfig: function () {
                if (this.opencgaClient instanceof OpenCGAClient) {
                    this.opencgaClient.users().getConfig("iva", {}, {})
                            .then(function (response) {
                                let config = response.response[0].result[0];
                                for (let key in config) {
                                    $("#" + key + "> input").val(config[key]);
                                }
                            });
                }
            },
            buildConfig: function (e) {
                if (Object.keys(this.config).length > 0 && this.opencgaClient instanceof OpenCGAClient) {
                     this.opencgaClient.users().updateConfig("iva", this.config, {})
                             .then(function (response) {
                                 console.log(response)
                             });
                }

            }
        });
    </script>
</dom-module>
